---
layout: post
title: 매트랩 시리얼 통신 버퍼링
date: 2018-11-15 12:10:00 +0900
author: 원성규
excerpt: 매트랩 시리얼 통신에서 나타난 버퍼링을 비디오 메모리와 비교하여 고찰하였다.
categories: matlab
tags:
- matlab
- serial
- gps
keywords:
---

### 비디오 버퍼링

모니터에 게임 화면이 나타나는 원리는 비디오 메모리를 모니터에서 가져가서 뿌려주는 것이다.
고사양 PC에서 fps가 크게 나타나는 이유는 비디오 처리량이 커서 단위 시간에 많은 프레임을 생성했기 때문이다.
그러나 모니터에서 나타낼 수 있는 fps의 한계로 인해서 그보다 많은 정보를 처리하지는 못한다.
비디오 프레임이 300일 때 게이밍 모니터는 한계값인 144 fps를 실제로 보여줄 것이다.


이 때 어떤 일이 일어나고 있는 것일까?
아마도 비디오 메모리는 초당 300번 갱신되고 있고 모니터에서는 초당 144번 차례에 당첨된 프레임을 가져가서 화면에 뿌렸을 것이다.
그리고 여분의 프레임은 버려졌을 것이다.
반대로 비디오 프레임이 30이었다면 모니터에서 비디오 메모리를 읽을 때 이미 읽었던 프레임을 다시 읽는 일이 자주 발생할 것이다.
실제는 갱신되지 않았다는 신호에 의해서 화면 업데이트가 없을 뿐이지 프레임을 중복 전송하지는 않았을 것이다.

### 시리얼 통신

시리얼 통신을 사용하는 GPS 수신기는 비디오에서 프레임 전송하는 것과 비교하면 어떤 상황일까?
내가 아직 통신 버퍼의 동작을 정확하게 알지 못하기 때문에 두 상황을 비교하여 유추하고자 한다.
일단은 GPS 통신과 비디오 프레임 전송에서 버퍼를 다루는 방식은 다르지 않을 것으로 생각된다.
기본적으로 전송 속도는 통신장비의 스펙에 맞추어 주어야 하며 GPS 수신기에서는 9600 bps이다.

### 버퍼링 원인

여기서 단지 헤깔리는 점은 버퍼링이 발생하는 원인이다. 
이벤트 방식을 사용하는 랩뷰에서는 버퍼링도 나타나지 않았고 CPU 사용량도 5% 이내로 매우 작았던 것에 비해
매트랩 콘솔에서는 그래픽 처리방식에 따라서 버퍼링도 컸고 CPU 사용량도 30% 이상으로 매우 컸다.
버퍼링이 나타나면 데이타의 타임스탬프는 화면에 뿌려진 시각보다 30초 이전의 것이었다.

데이타를 전송하는데 시간이 드는 것이라면 전송 주기가 달라질지언정 위와 같은 시간 지연이 나타난 것인 이상한 일이다.
이런 시간 지연은 이전에 받은 데이타를 간직하고 있다가 30초가 지나서야 화면에 뿌려주었기 때문인데,
이것은 버퍼링이 데이타가 많아서 생긴것이 아니라 컴퓨팅 자원이 다른일을 하느라 바빠서 데이타 처리를 하지 않고 있었다는 것을 뜻한다.
그리고 내가 겪은 매트랩 콘솔에서의 버퍼링 상황에서 다른 일은 그래픽 처리를 말한다.

### 과거 정보

게임에서 비디오 프레임이 부족하면 화면 정보가 점프하는 상황이 발생한다. 중간 시각의 정보가 부족하기 때문이다.
이 상황에서 게이머가 겪는 문제는 현재 시각의 정보가 부족한 것이지 과거 정보가 화면에 나타나는 것은 아니다.

GPS를 읽어서 화면에 나타냈는데 과거 정보가 화면에 나타난 것에 대해서 나는 그냥 프로그램을 잘못 만들었다거나 적어도 도구를 잘못 사용했다는 결론을 내렸다. 
이제까지 매트랩에서 알고리즘 처리가 쉽다고 생각하여 많이 의존했었는데 더 조심해서 도구를 사용할 필요가 있다.


